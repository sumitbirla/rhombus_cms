<%= link_to "edit", edit_admin_cms_location_path(@location), class: "btn btn-sm btn-default pull-right" %>

<h2><i class="fa fa-map-marker"></i>&nbsp; <%= @location.name %></h2>

<div id="map_canvas" style="width: 100%; height: 240px; margin-bottom: 20px;"></div>

<div class="row-fluid">
<div class="col-md-8">

<h4>Summary</h4>
<table class="table table-condensed table-bordered summary">
	<% unless @location.user_id.nil? %>
	<tr>
		<td>User</td>
		<td><i class="icon-user"></i> <%= link_to @location.user, admin_system_user_path(@location.user) %></td>
	</tr>
	<% end %>
	<% unless @location.affiliate_id.nil? %>
	<tr>
		<td>Affiliate</td>
		<td><%= link_to @location.affiliate, admin_system_affiliate_path(@location.affiliate) %></td>
	</tr>
	<% end %>
	<tr>
		<td>Slug</td>
		<td><%= @location.slug %></td>
	</tr>
	<% unless @location.contact_person.blank? %>
	<tr>
		<td>Contact Person</td>
		<td><%= @location.contact_person %></td>
	</tr>
	<% end %>
	<% unless @location.email.blank? %>
	<tr>
		<td>Email</td>
		<td><%= mail_to @location.email %></td>
	</tr>
	<% end %>
	<% unless @location.phone.blank? %>
	<tr>
		<td>Phone</td>
		<td><a href="tel:<%= @location.phone %>"><%= @location.phone %></a></td>
	</tr>
	<% end %>
	<% unless @location.fax.blank? %>
	<tr>
		<td>Fax</td>
		<td><%= @location.fax %></td>
	</tr>
	<% end %>
	<% unless @location.website.blank? %>
	<tr>
		<td>Website</td>
		<td><%= link_to @location.website, @location.website %></td>
	</tr>
	<% end %>
	<tr>
		<td>Address</td>
		<td><%= @location.to_text(new_line: '<br>') %></td>
	</tr>
</table>


<% if @location.sublocations.length > 0 %>
	<h4>Sublocations</h4>
	<ul>
		<% @location.sublocations.each do |sub| %>
		<li style="float: left; width: 25%"><%= sub %></li>
		<% end %>
	</ul>
  <div style="clear: left;"></div>
  <hr>
<% end %>

<% if @location.extra_properties.length > 0 %>
<h4>Extra Properties</h4>
<table class="table table-condensed table-bordered summary">
	<% @location.extra_properties.each do |ep| %>
	<tr>
		<td><%= ep.name %></td>
		<td><%= ep.value %></td>
	</tr>
	<% end %>
</table>
<hr/>
<% end %>


<% unless @location.summary.blank? %>
<h4>Summary</h4>
<%= @location.summary %>
<hr/>
<% end %>

<% unless @location.description.blank? %>
<h4>Description</h4>
<%= @location.description.gsub("\n", "<br/>").html_safe %>
<% end %>

</div>


<div class="col-md-4">
	<h4>Pictures</h4>
	<% @location.pictures.each do |pic| %>
	<a href="<%= cdn_image_url pic, 700, 600, 0 %>" data-lightbox="image-1">
		<img src="<%= cdn_image_url pic, 60, 60, 2 %>" class="img-thumbnail" style="margin: 4px" title="<%= pic.caption %>"/>
	</a>
	<% end %>
	<hr/>
	
	<h4>Categories</h4>
	<ul>
		<% @location.categories.each do |cat| %>
		<li><%= cat.name %></li>
		<% end %>
	</ul>
	<hr/>
  

  
  <h4>Flags</h4>
  <% if @location.hidden %>
    <span class="label label-warning">hidden</span> &nbsp; 
  <% else %>
    <span class="label label-success">visible</span> &nbsp; 
  <% end %>

</div>

</div> <!-- row-fluid -->



<% content_for :title do %>
    Locations: <%= @location.name%>
<% end %>


<% content_for :breadcrumbs do %>
	<li><a href="#">Web Content</a></li>
	<li><%= link_to "Locations", admin_cms_locations_path %></li>
	<li class="active"><%= @location.name %></li>
<% end %>


<% content_for :head do %>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
        var geocoder;
        var map;
        function initialize() {
            geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(-34.397, 150.644);
            var mapOptions = {
                zoom: 14,
                //center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
        }

        function codeAddress() {
            initialize();
            var address = '<%= @location.to_map %>';
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    map.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }
		
		$(document).ready(function () {
			initialize();
		    codeAddress();
		});
    </script>
<% end %>

